<section class="section section-light">
  <div class="container song-catalog">

    <!-- Top Search / Actions -->
    <div class="catalog-header">
      <div class="search-stack">
        <input
          type="text"
          [(ngModel)]="searchQuery"
          (ngModelChange)="onSearch()"
          placeholder="Search Songs..."
          class="search-bar"
          aria-label="Search Songs"
        />
        <div class="search-filters muted">
          <label>
            <input type="checkbox" [(ngModel)]="searchByTitle" (change)="onSearch()" />
            Title
          </label>
          <label>
            <input type="checkbox" [(ngModel)]="searchByAuthor" (change)="onSearch()" />
            Author
          </label>
          <label>
            <input type="checkbox" [(ngModel)]="searchByTheme" (change)="onSearch()" />
            Theme
          </label>
          <label>
            <input type="checkbox" [(ngModel)]="searchByLyrics" (change)="onSearch()" />
            Lyrics
          </label>
        </div>
      </div>

      <div class="actions">
        <a class="btn btn-primary" [routerLink]="['/songs', 'new']">+ New Song</a>
      </div>
    </div>

    <!-- Alphabet Bar -->
    <div class="alpha-bar muted">
      <span *ngFor="let letter of alphabet" (click)="filterByLetter(letter)" class="alpha-item">
        {{ letter }}
      </span>
    </div>

    <div class="catalog-body">
      <!-- Song List -->
      <div class="song-list">
        <div class="song-row" *ngFor="let song of songs; trackBy: trackById">
          <div class="thumb" aria-hidden="true"></div>
          <div class="song-meta">
            <a [routerLink]="['/songs', song.id]" class="song-title">
              {{ song.title }}
            </a>
            <p class="song-writers muted">
              ({{ song.writers || 'Unknown Writers' }})
            </p>
            <p class="song-artist">
              {{ song.artist || 'Unknown Artist' }}
              <span class="muted"> - {{ song.album || 'Unknown Album' }}</span>
            </p>
          </div>
          <div class="song-actions">
            <span class="song-duration muted">{{ song.duration || '--:--' }}</span>
            <button class="btn btn-ghost btn-small" (click)="openAddToSetlist(song)">➕ Add To Setlist</button>
          </div>
        </div>

        <!-- Empty state -->
        <div class="empty muted" *ngIf="songs?.length === 0">
          No songs match your search. Try a different term or <a [routerLink]="['/songs','new']">add a new song</a>.
        </div>
      </div>

      <!-- Sidebar -->
      <aside class="sidebar">
        <a class="btn btn-primary w-100" [routerLink]="['/songs','new']">+ New Song</a>
        <ul class="nav-links">
          <li><a href="#">Alpha</a></li>
          <li><a href="#">Popular</a></li>
          <li><a href="#">New</a></li>
          <li><a href="#">Recently Viewed</a></li>
          <li><a href="#">Group Songs</a></li>
          <li><a href="#">My Songs</a></li>
        </ul>
      </aside>
    </div>

    <!-- Pagination Controls -->
    <div class="pagination center" *ngIf="totalPages > 1">
      <button class="btn btn-ghost" (click)="prevPage()" [disabled]="currentPage === 1">
        ← Prev
      </button>
      <span>Page {{ currentPage }} of {{ totalPages }}</span>
      <button class="btn btn-ghost" (click)="nextPage()" [disabled]="currentPage === totalPages">
        Next →
      </button>
    </div>
  </div>

  <!-- Add to Setlist Modal -->
  <div class="modal-backdrop" *ngIf="isModalOpen" (click)="closeModal()">
    <div class="modal" (click)="$event.stopPropagation()">
      <h3>Add “{{ selectedSong?.title }}” to a setlist</h3>

      <div class="mode-toggle">
        <button
          class="mode-btn"
          [class.active]="!creatingNew"
          (click)="creatingNew = false"
        >Choose Existing</button>
        <button
          class="mode-btn"
          [class.active]="creatingNew"
          (click)="creatingNew = true"
        >Create New</button>
      </div>

      <!-- Existing Setlist -->
      <div *ngIf="!creatingNew">
        <label class="field-label">Select a setlist</label>
        <select class="select" [(ngModel)]="selectedSetlistId">
          <option [ngValue]="null" disabled>Select…</option>
          <option *ngFor="let s of setlists" [ngValue]="s.id">{{ s.name }}</option>
        </select>
        <button class="btn btn-primary w-100" [disabled]="!selectedSetlistId || actionLoading" (click)="addToExisting()">
          {{ actionLoading ? 'Adding…' : 'Add to Setlist' }}
        </button>
      </div>

      <!-- New Setlist -->
      <div *ngIf="creatingNew">
        <label class="field-label">New setlist name</label>
        <input class="input" type="text" [(ngModel)]="newSetlistName" placeholder="e.g., March 9 Sunday AM" />
        <button class="btn btn-primary w-100" [disabled]="!newSetlistName.trim() || actionLoading" (click)="createSetlistAndAdd()">
          {{ actionLoading ? 'Creating…' : 'Create & Add' }}
        </button>
      </div>

      <button class="btn btn-ghost w-100" (click)="closeModal()">Cancel</button>

      <p class="muted small" *ngIf="errorMsg">{{ errorMsg }}</p>
      <p class="success small" *ngIf="successMsg">{{ successMsg }}</p>
    </div>
  </div>
</section>
